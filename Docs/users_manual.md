---
title: "Руководство пользователя"
author: "Система диагностики приемного тракта ИРНР"
date: "2025-06-27"
subject: "Markdown"
keywords: [Markdown, Example]
lang: "ru"
titlepage: true
titlepage-background: box.jpg
titlepage-text-color: 101010
toc: true
toc-own-page: true
fontfamily: dejavu
#fontfamilyoptions: default (opensans)
header-includes: |
	\usepackage[utf8]{inputenc}
	\usepackage[T2A]{fontenc}
	\renewcommand{\familydefault}{\sfdefault}	
	\let\oldsection\section
	\renewcommand{\section}{\clearpage\oldsection}

...

# Введение

Данный документ содержит описание компонентов в составе системы диагностики приемного тракта ИРНР, включая программируемый генератор сигналов ("калибратор") а также сопутствующие утилиты управления и анализа данных, и рассматривает подходы к проведению измерений. В первой части содержится техническая документация к генератору сигналов, включая описание физических интерфейсов, принципиальную схему и протоколы сетевого взаимодействия. Во второй части содержится описание утилит управления и анализа данных.

# Генератор тестовых сигналов

Генератор сигналов выполнен в виде устанавливаемого в стойку блока и построен на основе микроконтроллера STM32F746 и цифрового синтезатора сигналов AD9910.

## Интерфейсы на задней и передней панели

![Схема интерфейсов на задней и передней панели](Images/physical_interfaces.drawio.pdf)

> Для включения генератора сигналов нужно предоставить **питание и опорный тактовый сигнал,** частота которого составляет 25 МГц, а уровень равен 500 мВ.

Индикатор питания загорается зеленым, когда питание генератора сигналов включено (выключатель питания находится в положении "вверх") и опорный тактовый сигнал поступает. При пропадании опорного тактового сигнала индикатор питания потухнет.

В случае пропадания опорного тактового сигнала генератор производит перезагрузку и ожидает появления тактового сигнала.

Индикатор излучения загорается желто-зеленым, когда запущено воспроизведение и генератор ожидает очередное триггерное событие, чтобы излучить следующий импульс из очереди сигналов. Индикатор излучения также загорается, когда генератор излучает в непрерывном режиме.

## Протокол сетевого взаимодействия

> Для управления генератором сигналов его нужно подключить к локальной сети через интерфейс Ethernet. Генератор сигналов присваивает себе фиксированный **IP-адрес 192.168.0.12;** проверить доступность генератора сигналов в локальной сети можно путём отправки ping-запросов при помощи утилиты ping.

Взаимодействие с генератором сигналов происходит посредством протокола TCP. Управление осуществляется при помощи текстовых команд в интерактивном интерфейсе командной строки. Возможно управление как в ручном режиме, так и при помощи утилит, частично автоматизирующих процесс (будут рассмотрены далее.)

Чтобы подключиться к генератору для управления вручную, необходимо воспользоваться утилитой netcat (Linux) либо putty (Windows). Подключение осуществляется на порт 80. После подключения выводится приветствие и приглашение ввода команды.

В выбранный момент времени возможно только одно подключение к генератору сигналов. Генератор отказывает в принятии дополнительных подключений. Программа, открывшая подключение, становится исключительным владельцем генератора на время жизни подключения.

Далее рассмотрена система команд генератора.

**СОЗДАНИЕ СИГНАЛОВ**

|**Команда**|**Пояснение**|
|---|---|
|rfkill|Прекратить излучение|
|set_level [value] [unit]|Задать уровень сигналов в вольтах (rms), напр. `set_level 270 mV`; действует только на новые сигналы|
|dbg_level [asf] [fsc]|Напрямую задать уровень сигналов в машинных кодах синтезатора, напр. `dbg_level 16383 255`; действует только на новые сигналы|
|test_tone [freq] [unit]|Подавать непрерывный сигнал на указанной частоте, напр. `test_tone 158 MHz`|
|basic_pulse [delay] [unit] [duration] [unit] [freq] [unit]|Подавать импульсы с указанной задержкой, длительностью и частотой, напр. `basic_pulse 1200 us 900 us 158 MHz`|
|basic_sweep [delay] [unit] [duration] [unit] [center_freq] [unit] [a] [b]|Подавать ЛЧМ сигналы с указанной задержкой, длительностью, центральной частотой и полосой, напр. `basic_sweep 1200 us 900 us 158 MHz 77 1`|

> Примечание 1: частоты и время можно указывать со знаками после запятой (точки) и в разных единицах (us, ns, Hz, kHz, MHz)

> Примечание 2: команды basic_pulse и basic_sweep сбрасывают очередь сигналов; они предоставляют возможности по немедленному созданию сигналов и предназначены прежде всего для проверки генератора в интерактивном режиме, а не для измерений.

**УПРАВЛЕНИЕ ОЧЕРЕДЬЮ СИГНАЛОВ**

|**Команда**|**Пояснение**|
|---|---|
|seq run|Запустить воспроизведение|
|seq stop|Остановить воспроизведение|
|seq reset|Очистить очередь|
|seq show|Просмотреть содержимое очереди|
|seq pulse [...]|Добавить импульс в конец очереди; порядок аргументов схож с basic_pulse|
|seq sweep [...]|Добавить ЛЧМ сигнал в конец очереди; порядок аргументов схож с basic_sweep|
|seq json [...]|Добавить сложный сигнал на основе JSON-дескриптора в конец очереди|

**СИСТЕМНЫЕ КОМАНДЫ** 

|**Команда**|**Пояснение**|
|---|---|
|isr|Просмотреть статистику прерываний процессора|
|mem|Просмотреть статистику использования и фрагментации памяти|
|perf|Просмотреть статистику ввода/вывода и прочих событий|
|reboot|Перезагрузить генератор|

**СЛУЖЕБНЫЕ ТЕСТОВЫЕ КОМАНДЫ**

|**Команда**|**Пояснение**|
|---|---|
|ram_test|Выполнить тест оперативной памяти AD9910|
|write|Записать снимок регистров AD9910 в регистры AD9910|
|verify|Сверить содержимое регистров AD9910 со снимком в памяти микроконтроллера|

**СОЗДАНИЕ СИГНАЛОВ (ДОПОЛНИТЕЛЬНЫЕ ВИДЫ)**

|**Команда**|**Пояснение**|
|---|---|
|basic_xmitdata fsk [delay] [unit] [f1] [unit] [f2] [unit] [tstep] [unit] [data]+ |Подавать импульс с двоичной частотной манипуляцией, с указанной задержкой, первой и второй частотой, длительностью элементов кода, и кодовой последовательностью, напр. `basic_xmitdata fsk 0 us 900 us 40 us 1 1 0 1`|
|basic_xmitdata psk [delay] [unit] [freq] [unit] [tstep] [unit] [data]+ |Подавать импульс с двоичной фазовой манипуляцией (BPSK), с указанной задержкой, частотой, длительностью элементов кода, и кодовой последовательностью, напр. `basic_xmitdata psk 0 us 900 us 40 us 1 1 0 1`|
|basic_xmitdata ram_psk [delay] [unit] [freq] [unit] [tstep] [unit] [data]+ |как `basic_xmitdata ram_psk`, но использует оперативную память AD9910|

**ПРИМЕР ИСПОЛЬЗОВАНИЯ ОЧЕРЕДИ СИГНАЛОВ**

```
seq sweep 0 us 18000 us 159.0 MHz 1 1
seq pulse 0 us 18000 us 159.524 MHz
seq sweep 0 us 18000 us 159.0 MHz -1 1
seq pulse 0 us 18000 us 158.476 MHz
seq run
```

**ДОПОЛНЕНИЕ: ПОЛОСА ЛЧМ СИГНАЛОВ**

Параметры a и b для ЛЧМ сигналов являются целыми числами, представляющими машинные коды для блока генерации ЛЧМ в AD9910. Полоса ЛЧМ сигнала в Гц выражается на основе данных параметров совместно с длительностью сигнала:

```
steps = duration * 250 MHz / b
band = a * (1 GHz / 2^32) * (steps - 1)
```

|Параметр|Значение|
|---|---|
|duration|Длительность сигнала в секундах|
|a|Величина шага в единицах FTW|
|b|Делитель частоты шагов|

Когда a положительное, частота ЛЧМ сигнала нарастающая, то есть конечная частота выше начальной. Если a отрицательное, то частота ЛЧМ будет убывающая, когда конечная частота ниже начальной.

Вот некоторые возможные комбинации a и b:

|duration|a|b|Полоса|
|---|---|---|---|
|18000 us|1|1|~1.04773 MHz|
|900 us|1|1|~52.386 kHz|
|900 us|10|1|~0.52386 MHz|
|900 us|20|1|~1.04773 MHz|

## Внутреннее строение

![Структурная схема генератора тестовых сигналов](Images/signal_generator.drawio.pdf)

В состав генератора сигналов входит:

- Блок питания, создающий напряжение 5V
- Микроконтроллерная плата Nucleo F746ZG
- Плата-переходник, выводящая управляющие сигналы с микроконтроллера и создающая напряжения 3.3V и 1.8V
- Плата с синтезатором AD9910
- Усилитель, выполняющий защитную роль

# Утилиты управления и анализа данных

Набор утилит управления и анализа данных предназначен для организации процесса диагностики приемного тракта станции. В его состав входят программные инструменты для управления генератором сигналов и штатным регистрирующим комплексом на этапе сбора данных, а также утилиты для оценки характеристик на основе полученных данных.

**УТИЛИТЫ**

|**Название**|**Пояснение**|
|---|---|
|c2.py|На основе диагностического шаблона организует пропускание последовательностей тестовых сигналов через тракт|
|mksweep.py|Генерирует диагностические шаблоны с ЛЧМ сигналами на сетке частот|
|phase_delta.py|Выполняет оценку разности фаз между каналами|
|amplitude_response.py|Выполняет оценку АЧХ|
|phase_response.py|Выполняет оценку ФЧХ|

## Развертывание

Утилиты взаимодействуют со штатным ПО регистрирующего комплекса и поэтому предполагают развертывание в среде регистрирующего комплекса, а не на отдельной машине.

Для работы утилит необходим интерпретатор Python. Поскольку регистрирующий комплекс работает Windows 7, официальные сборки новых версий установить не получится из-за прекращения поддержки данной ОС. Необходимо использовать сборку от сообщества, в которой восстановлена совместимость: [https://github.com/adang1345/PythonWin7.](https://github.com/adang1345/PythonWin7)

Также необходимы библиотеки numpy и plotly, которые можно установить, выполнив `py -m pip install numpy plotly` в командной строке.

Далее требуется скачать репозиторий с утилитами и расположить его в обозначенном месте на файловой системе.

**РАЗМЕЩЕНИЕ НА ДИСКЕ**

|**Директория**|**Содержимое**|
|---|---|
|c:/workprogs/calibrator_software|Набор утилит управления и анализа|
|c:/workprogs/calibrator_mode|Отдельная копия штатного ПО регистрирующего комплекса, предназначенная специально для проведения диагностических измерений|
|c:/calibrator-data-v1|Поддиректории с данными, накопленными в процессе измерений|

> Примечание: возможно, директории с записями и копию штатного ПО следует разместить на общем сетевом диске --- это позволило бы запускать утилиты на отдельной от регистрирующего комплекса машине.

# Проведение измерений

## Пробное включение