## Команды в текстовом интерфейсе

### test_tone [freq] [unit]

Подача непреревного сигнала на указанной частоте.

Пример: `test_tone 159.0 MHz`

![test_tone 159 MHz](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/b8247705-0dce-4c52-bee0-04f8d200ca63)

### basic_pulse [offset] [unit] [duration] [unit] [freq] [unit]

Подача импульсов некоторой длительности на некоторой частоте, с некоторым отступом от триггера.

Пример: `basic_pulse 0 us 18000 us 159.0 MHz`

![basic_pulse 0 us 18000 us 159 MHz](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/811c9247-69cc-470e-939c-28d8a6da24cb)

### basic_sweep [offset] [unit] [duration] [unit] [center_freq] [unit] [a] [b]

Свипы некоторой продолжительности, с некоторым отступом от триггера, на некоторой центральной частоте, с некоторой общей полосой.

Полоса определена как (duration / 4 ns) * (1 GHz / 2^32) * (a/b)

Если a положительное, то направление свипа будет нарастающее, т.е. начальная частота свипа будет ниже конечной частоты. Если же a отрицательное, то направление свипа будет убывающим, когда начальная частота выше конечной частоты.

Вот некоторые возможные комбинации a и b:

|duration|a|b|Полоса|
|---|---|---|---|
|18000 us|1|1|~1.04773 MHz|
|900 us|1|1|~52.386 kHz|
|900 us|10|1|~0.52386 MHz|
|900 us|20|1|~1.04773 MHz|

Можно получить значения с меньшим количеством знаков после запятой, если использовать длительность, равную степени двойки:

|duration|a|b|Полоса|
|---|---|---|---|
|2^20ns|128|1|7.8125 MHz|
|2^20ns|256|1|15.625 MHz|
|2^20ns|512|1|31.25 MHz|

Параметры для свипов с теоретически целой полосой:

|duration|a|b|Полоса|
|---|---|---|---|
|2^20ns|2048|5|25 MHz|
|2^20ns|6144|25|15 MHz|
|2^20ns|4096|25|10 MHz|

TODO: Проверить комбинацию a = 2048000, b = 125000; будет ли последний шажок пропущен?

Пример свипа с положительным a: `basic_sweep 0 us 18000 us 159.0 MHz 1 1`

![basic_sweep 0 us 18000 us 159 0 MHz 1 1](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/42b9fbb8-24d8-41ef-bb70-10d8a34ef350)

Привер свипа с отрицательным a: `basic_sweep 0 us 18000 us 159.0 MHz -1 1`

![basic_sweep 0 us 18000 us 159 MHz -1 1](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/dad0410a-4e60-432f-98e3-4a42e0b2e1b7)

## basic_xmitdata ram_psk [offset] [unit] [freq] [unit] [element_duration] [unit] [...]

Подача импульсов с BPSK модуляцией с использованием оперативной памяти AD9910.

Максимальная длительность элемента составляет 4 / (1 GHz) * 65535 = ~262мкс

Общая продолжительность сигнала определяется исходя из количества элементов и длительности одного элемента.

Элементы кода записываюся после основной команды и могут быть равны 0 либо 1, где 0 - нет сдвига фазы, а 1 - фаза сдвинута на 180 градусов.

Максимальное количество элементов в коде составляет 1023. Всего оперативная память AD9910 может вместить 1024 элемента, но последний элемент зарезервирован для прерывания сигнала.

Пример: `basic_xmitdata ram_psk 0 us 159.0 MHz 200 us 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0`

![basic_xmitdata ram_psk 0 us 159 0 MHz 200 us 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/9d44b6c3-7886-439b-b150-7b878d2c6e5a)

## seq [...]

Команды секвенсора позволяют задавать последовательности из разных сигналов. При воспроизведении последовательность в секвенсоре повторяется бесконечно.

|Команда|Пояснение|
|---|---|
|seq pulse [...]|Добавить сигнал с фиксированной частотой в конец очереди; порядок аргументов идентичен basic_pulse|
|seq sweep [...]|Добавить свип в конец очереди; порядок аргументов идентичен basic_sweep|
|seq run|Запустить воспроизведение|
|seq stop|Остановить воспроизведение|
|seq reset|Очистить очередь|

Пример:

```
seq sweep 0 us 18000 us 159.0 MHz 1 1
seq pulse 0 us 18000 us 159.524 MHz
seq sweep 0 us 18000 us 159.0 MHz -1 1
seq pulse 0 us 18000 us 158.476 MHz
seq run
```

![sequencer](https://github.com/AXKuhta/stm32_ad9910/assets/11133304/f3c8a885-f8eb-494d-8bab-78471956a0b9)
