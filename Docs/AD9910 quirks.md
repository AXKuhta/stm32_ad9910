
## Sweep от f1 до f2, когда f2 > f1

Блок DRG в AD9910 имеет регистры нижней и верхней границы. В них записываются значения начальной и конечной частоты ЛЧМ-сигнала.

AD9910 не имеет возможности сбросить счётчик DRG на значение верхней границы. Предусмотрен только сброс на значение нижней границы.

Казалось бы, это делает невозможным создание ЛЧМ сигналов, где f2 > f1.

На помощь приходят "зеркальные" значение частоты:

Когда F<sub>set</sub> > SYSCLK/2, получается F<sub>out</sub> = SYSCLK - F<sub>set</sub>

| Значение | Название |
| --- | --- |
| SYSCLK | Тактовая частота AD9910
| F<sub>set</sub> | установленная частота |
| F<sub>out</sub> | частота на выходе |

При работе в таком режиме, начальная фаза сигнала получается повернутой на 180°, что можно компенсировать при помощи сдвига фазы в профилях.

## Проблема с переключением профилей

При отсутствии синхронизации с SYNC_CLK, переключение более одной ножки профиля за раз может быть неправильно воспринято AD9910. Профиль гарантированно переключится, но не на тот, на который требовалось. Исчезнет ли проблема, если синхронизировать переключение профилей с SYNC_CLK - не известно, хотя даташите указано, что для входов профилей "State changes should be set up on the SYNC_CLK pin." 

Есть одно исключение: переключение с любого профиля на профиль 0 всегда работает правильно.

Переключение между профилями, которые отличаются только один бит, всегда работает правильно.

Вот таблица допустимых переключений с нулевого профиля:

| P<sub>до</sub> | P<sub>после</sub> | Работает? |
| --- | --- | --- |
| 0 | 1 | Да |
| 0 | 2 | Да |
| 0 | 3 | Нет |
| 0 | 4 | Да |
| 0 | 5 | Нет |
| 0 | 6 | Нет |
| 0 | 7 | Нет |

## Проблема с режимом zero-crossing

Режим zero-crossing позволяет задержать применение новых параметров DDS до того момента, когда фаза будет равна нулю (хотя даташит упоминает только задержку применения сдвига фазы, в режиме полярной модуляции задерживается применение сдвига фазы *и амплитуды*).

При использовании некоторых значений FTW, zero-crossing может задерживать применение новых параметров на чрезмерно большое время. Проблема связана именно с отдельными значениями FTW, а не с частотой AD9910.

Если взглянуть на Figure 27. DDS Block Diagram в даташите AD9910, то можно заметить, что фаза берётся из старших 19 бит аккумулятора фазы, в который на каждом такте прибавляется текущее значение FTW.

Некоторые значения FTW, например 0x26666666, могут привести к тому, что старшие 19 бит аккумулятора фазы на протяжении длительного времени не будут принимать нулевое значение. В случае с 0x26666666, потребуется 536850447 тактов, чтобы вновь дойти до нулевой фазы. Это займёт 536.8 мс, если тактовая частота AD9910 составляет 1 ГГц.

Можно найти значения FTW, которые приводят к совсем плохим результатам, например 0x33333333. На получение нулевой фазы в этом случае уйдёт 4294926341 тактов!
